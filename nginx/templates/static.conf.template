server {
    listen 443 ssl http2;
    server_name ${FRONT_DOMAIN};
       
    location / {
    	root /static/frontend;
    	index /index.html;
    	try_files $uri $uri/ /index.html;
    }

    ssl_certificate /etc/letsencrypt/live/${FRONT_DOMAIN}/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/${FRONT_DOMAIN}/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    ssl_protocols TLSv1.2;
}

server {
    listen 80;
    server_name ${FRONT_DOMAIN};
    
    if ($host = ${FRONT_DOMAIN}) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    return 404; # managed by Certbot
}

server {
  listen 443 ssl http2;
  server_name ${API_DOMAIN};
  charset utf-8;

  location /static/ {
       add_header Access-Control-Allow-Origin https://${FRONT_DOMAIN};
       root /static/django;
       autoindex off;
  } 
  location /uploads/ {
       add_header Access-Control-Allow-Origin https://${FRONT_DOMAIN}; 
       root /static/uploads;
       autoindex off;
  }

    ssl_certificate /etc/letsencrypt/live/${API_DOMAIN}/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/${API_DOMAIN}/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    ssl_protocols TLSv1.2;
}
