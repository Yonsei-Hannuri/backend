version: "3"

services:
  backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    platform: linux/amd64
    container_name: hannuri-backend
    volumes:
      - ./backend:/backend
      - ${DB_ROOT}:/backend/db
      - ${STATIC_FILE_ROOT}/uploads:/backend/uploads
      - ${STATIC_FILE_ROOT}/django:/backend/static
      - ${SECRET_FILE_ROOT}:/backend/secret
    command: bash -c "cd /backend && python3 manage.py migrate && gunicorn -w 3 --bind 0:2102 backend.wsgi"
    ports:
      - 2102:2102
